#!/usr/bin/php
<?php
echo "\n\033[48;5;255m--------------------------------------------------------------------------------\033[0m\n";

echo "\033[48;5;255m---------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m----------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-----\033[0m";
echo "\033[48;5;0m----------------\033[0m";
echo "\033[48;5;255m-----\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m----------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m---------\033[0m\n";

echo "\033[48;5;255m---------\033[0m";
echo "\033[48;5;0m-----\033[0m";
echo "\033[48;5;255m---------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-----\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m----------\033[0m\n";

echo "\033[48;5;255m---------\033[0m";
echo "\033[48;5;0m------\033[0m";
echo "\033[48;5;255m--------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-----\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-----------\033[0m\n";

echo "\033[48;5;255m---------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-\033[0m";
echo "\033[48;5;0m--\033[0m";
echo "\033[48;5;255m-------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-----\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m----\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m------------\033[0m\n";

echo "\033[48;5;255m---------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--\033[0m";
echo "\033[48;5;0m--\033[0m";
echo "\033[48;5;255m------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-----\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m---------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-------------\033[0m\n";

echo "\033[48;5;255m---------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m---\033[0m";
echo "\033[48;5;0m--\033[0m";
echo "\033[48;5;255m-----\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-----\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m----------\033[0m";
echo "\033[48;5;0m--------\033[0m";
echo "\033[48;5;255m--------------\033[0m\n";

echo "\033[48;5;255m---------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m----\033[0m";
echo "\033[48;5;0m--\033[0m";
echo "\033[48;5;255m----\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-----\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m----------\033[0m";
echo "\033[48;5;0m--------\033[0m";
echo "\033[48;5;255m--------------\033[0m\n";

echo "\033[48;5;255m---------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-----\033[0m";
echo "\033[48;5;0m--\033[0m";
echo "\033[48;5;255m---\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-----\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m----------\033[0m";
echo "\033[48;5;0m--------\033[0m";
echo "\033[48;5;255m--------------\033[0m\n";

echo "\033[48;5;255m---------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m------\033[0m";
echo "\033[48;5;0m--\033[0m";
echo "\033[48;5;255m--\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-----\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m---------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-------------\033[0m\n";

echo "\033[48;5;255m---------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-------\033[0m";
echo "\033[48;5;0m--\033[0m";
echo "\033[48;5;255m-\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-----\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m----\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m------------\033[0m\n";

echo "\033[48;5;255m---------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--------\033[0m";
echo "\033[48;5;0m------\033[0m";
echo "\033[48;5;255m-----\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-----------\033[0m\n";

echo "\033[48;5;255m---------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m---------\033[0m";
echo "\033[48;5;0m-----\033[0m";
echo "\033[48;5;255m-----\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m--------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m----------\033[0m\n";

echo "\033[48;5;255m---------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m----------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m-----\033[0m";
echo "\033[48;5;0m----------------\033[0m";
echo "\033[48;5;255m-----\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m----------\033[0m";
echo "\033[48;5;0m----\033[0m";
echo "\033[48;5;255m---------\033[0m\n";

echo "\033[48;5;255m--------------------------------------------------------------------------------\033[0m\n";

	function opt_exists($str) {
		if (strpos($str, "w"))
			return true;
		return false;
	}

	$t = microtime(true);
	$x = 1;
	$err = false;

	if ($argv[1][0] == '-') {
		$x++;
		if (opt_exists($argv[1])) {
			if (strpos($argv[1], "w")) {
				if ($argc == 5) {
					$x++;
					$word = preg_replace("/[\/|\\\\|\||\^|\[|\]|\{|\}|\(|\)|\,]/", "\\\\$0", preg_replace("/\*/", ".*", $argv[2]));
				}
				else
					$err = "few";
			}
		}
		else
			$err = "opt";
	}

	$mess_fname = $argv[$x];
	$dico_fname = $argv[$x + 1];

	if (!file_exists($mess_fname))
		$err = "wrg_mess";
	else if (!file_exists($dico_fname))
		$err = "wrg_dico";
	else if (!is_readable($mess_fname))
		$err = "nread_mess";
	else if (!is_readable($dico_fname))
		$err = "nread_dico";

	if (!$err) {
		echo "\n\033[0;30;48;5;255m------------------------------------WELCOME-------------------------------------\033[0m\n\n";
		$i = 0;
		$j = 0;

		$mess = fopen($mess_fname, "r");
		$dico = fopen($dico_fname, "r");
		if ($mess && $dico) {
			preg_match_all("/\S+
/", fread($mess, filesize($mess_fname)) . "\n", $words);
			preg_match_all("/\S+
/", strtolower(fread($dico, filesize($dico_fname))) . "\n", $trad);

			$combine = array_combine($trad[0], $trad[0]);

			if (!isset($word)) {
				foreach ($words[0] as $val) {
					if (isset($combine[strtolower($val)])) {
						echo $val;
						$i++;
					}
					$j++;
				}
			}
			else {
				$k = 0;
				foreach ($words[0] as $val) {
					if (isset($combine[strtolower($val)])) {
						if (preg_match("/\A\s*" . $word . "\s*\z/i", $val)) {
							echo "\033[32m" . $val . "\033[0m";
							$k++;
						}
						else
							echo $val;
						$i++;
					}
					$j++;
				}
			}
			echo "\nRecherche terminée en :\t\033[33m" . round(microtime(true) - $t, 7) . "\033[0m sec.";
			echo "\nMots trouvés :\t\t\033[33m" . $i . "\033[0m";
			echo "\nTotal de mots :\t\t\033[33m" . $j . "\033[0m\n";
			if (isset($word))
				echo "\nLe mot \033[32m" . $argv[2] . "\033[0m a été trouvé \033[33m" . $k . "\033[0m fois.\n\n";
		}
		else {
			if (!$mess)
				echo "nox.php: " . $argv[1] . ": Cannot open file\n";
			else if (!$dico)
				echo "nox.php: " . $argv[2] . ": Cannot open file\n";
		}
		if ($mess)
			fclose($mess);
		if ($dico)
			fclose($dico);
		echo "\n\033[0;30;48;5;255m--------------------------------------END---------------------------------------\033[0m\n\n";
	}
	else {
		if ($err == "few")
			echo "usage: ./nox.php [-w word] filename list\n";
		else if ($err == "opt")
			echo "nox.php: invalid option " . $argv[1] . "\n";
		else if ($err == "wrg_mess")
			echo "nox.php: " . $mess_fname . ": No such file or directory\n";
		else if ($err == "wrg_dico")
			echo "nox.php: " . $dico_fname . ": No such file or directory\n";
		else if ($err == "nread_mess")
			echo "nox.php: " . $mess_fname . ": Permission denied\n";
		else if ($err == "nread_dico")
			echo "nox.php: " . $dico_fname . ": Permission denied\n";
		else
			echo "usage: ./nox.php [-w word] filename list\n";
	}
?>